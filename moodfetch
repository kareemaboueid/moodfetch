#!/usr/bin/env bash
# vim: noai:ts=4:sw=4:expandtab
# shellcheck source=/dev/null
# shellcheck disable=2009

# helper: read battery percentage and charging status if available
get_battery_status() {
  # many Linux distros expose this under /sys/class/power_supply
  local bat_path="/sys/class/power_supply/BAT0"
  if [ -d "$bat_path" ]; then
    local capacity=$(cat "$bat_path/capacity" 2>/dev/null)
    local status=$(cat "$bat_path/status" 2>/dev/null)
    echo "$capacity $status"
  else
    echo "" # no battery info available
  fi
}

# --- MAIN ---
main() {
  # print ascii logo
  cat "./logo/ascii-art.txt"
  echo ""
  echo -e "\e[1mMood\e[0m"
  echo ""

  # first, check if we have a battery and how it feels
  battery_info=$(get_battery_status)

  if [ -n "$battery_info" ]; then
    battery_percentage=$(echo "$battery_info" | awk '{print $1}')
    battery_state=$(echo "$battery_info" | awk '{print $2}')

    # sarcasm based on battery life
    if [ "$battery_state" = "Charging" ]; then
      mood="Ah, finally plugged in. Feels like sipping espresso shots of electricity."
    elif [ "$battery_percentage" -le 15 ]; then
      mood="Running at ${battery_percentage}% — basically living on borrowed electrons."
    elif [ "$battery_percentage" -le 40 ]; then
      mood="Battery ${battery_percentage}% — alive but a bit hangry."
    else
      mood="Battery ${battery_percentage}% and holding steady. I can breathe easy."
    fi

  else
    # fallback: use uptime mood when no battery present
    uptime_hours=$(awk '{printf("%.1f", $1/3600)}' /proc/uptime)

    if (( $(echo "$uptime_hours < 1" | bc -l) )); then
      mood="Freshly booted, still smelling like a new car."
    elif (( $(echo "$uptime_hours < 24" | bc -l) )); then
      mood="Moderately awake. Let's not crash… yet."
    else
      mood="Been running for ${uptime_hours} hours. Basically a zombie server now."
    fi
  fi

  # print the chosen mood
  echo "$mood"
  echo ""
}
# ------

# Entry point
main "$@"
